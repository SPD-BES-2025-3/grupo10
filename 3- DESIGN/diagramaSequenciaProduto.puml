@startuml Fluxo de Cadastro de Item de Estoque

title "Fluxo de Controle - CRUD de Item de Estoque"

actor "Usuário" as usr
participant "EstoquePage" as page
participant "EstoqueController" as controller
participant "EstoqueRepository" as repository
database "MongoDB" as db
participant "RedisPublisher" as publisher
queue "Redis" as redis

skinparam sequenceArrowThickness 2
skinparam roundcorner 10

usr -> page: Preenche e envia formulário
activate page

page -> controller: POST /api/estoque
activate controller

controller -> repository: addOrUpdateProdutoEstoque(dados)
activate repository

repository -> db: findOneAndUpdate(...)
activate db
db --> repository: estoqueAtualizado
deactivate db

repository -> publisher: publishOperation("UPDATE", estoqueAtualizado)
activate publisher
publisher -> redis: PUBLISH crud-channel
deactivate publisher

repository --> controller: retorna estoqueAtualizado
deactivate repository

controller --> page: 201 Created / 200 OK
deactivate controller

page --> usr: Exibe mensagem de sucesso
deactivate page

@enduml
