@startuml C4_Component
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Diagrama de Componentes da API Backend

Container_Boundary(backend, "API Backend") {
    Component(routes, "Routes", "Express.js", "Define os endpoints da API (ex: /api/manutencao) e direciona para os controllers.")
    
    Component(controllers, "Controllers", "TypeScript", "Recebem as requisições, validam os dados de entrada e orquestram as operações.")
    
    Component(repositories, "Repositories", "TypeScript", "Encapsula a lógica de acesso ao banco de dados (Mongoose) e a publicação de eventos.")
    
    Component(models, "Models", "Mongoose", "Define os schemas e a estrutura dos documentos no MongoDB.")

    Component(redis_publisher, "Redis Publisher", "TypeScript / node-redis", "Componente responsável por enviar mensagens para o Redis.")
}

ContainerDb(database, "Banco de Dados", "MongoDB")
Container(redis, "Barramento de Eventos", "Redis")

Rel(routes, controllers, "Chama")
Rel(controllers, repositories, "Utiliza")
Rel(repositories, models, "Usa")
Rel(repositories, database, "Executa queries", "Mongoose")
Rel(repositories, redis_publisher, "Envia evento para publicar")
Rel(redis_publisher, redis, "Publica mensagem", "TCP")

@enduml
